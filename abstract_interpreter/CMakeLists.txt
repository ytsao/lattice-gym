cmake_minimum_required(VERSION 3.24)

project(abstract_interpreter_parser
    HOMEPAGE_URL "https://github.com/ytsao/lattice-gym"
    LANGUAGES CXX)

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++17")

# dependencies
include(FetchContent)
FetchContent_Declare(
    cpp_peglib
    GIT_REPOSITORY "https://github.com/ytsao/cpp-peglib"
    GIT_TAG        50ea4b05e9b1d599a06e1fb22e5658695cc1f24c
)
FetchContent_MakeAvailable(cpp_peglib)

# preparing the library
add_library(abstract_interpreter_parser INTERFACE)
target_include_directories(abstract_interpreter_parser INTERFACE ${cpp_peglib_SOURCE_DIR})
target_compile_options(abstract_interpreter_parser INTERFACE
    $<$<AND:$<COMPILE_LANGUAGE:CXX>,$<CXX_COMPILER_ID:MSVC>>:/Zc:__cplusplus /utf-8 /fp:strict>
    "$<$<AND:$<COMPILE_LANGUAGE:CUDA>,$<CUDA_COMPILER_ID:NVIDIA>,$<CXX_COMPILER_ID:MSVC>>:SHELL:--compiler-options /Zc:__cplusplus>"
    "$<$<AND:$<COMPILE_LANGUAGE:CUDA>,$<CUDA_COMPILER_ID:NVIDIA>,$<CXX_COMPILER_ID:MSVC>>:SHELL:--compiler-options /utf-8>"
    "$<$<AND:$<COMPILE_LANGUAGE:CUDA>,$<CUDA_COMPILER_ID:NVIDIA>,$<CXX_COMPILER_ID:MSVC>>:SHELL:--compiler-options /fp:strict>"
)
target_compile_options(abstract_interpreter_parser INTERFACE
    "$<$<AND:$<COMPILE_LANGUAGE:CUDA>,$<CUDA_COMPILER_ID:NVIDIA>>:SHELL:-diag-suppress 611>"  # Warning generated by the library cpp-peglib.
)

# example binary
add_executable(example_parser example/abstract_interpreter/parser.cpp)
target_link_libraries(example_parser PRIVATE abstract_interpreter_parser)

# documents
# find_package(Doxygen REQUIRED doxygen)

# set(DOXYGEN_PROJECT_NAME "Abstract Interpreter Project Library")
# set(DOXYGEN_BUILTIN_STL_SUPPORT YES)
# set(DOXYGEN_CASE_SENSE_NAMES NO)
# set(DOXYGEN_CLASS_DIAGRAMS NO)
# set(DOXYGEN_DISTRIBUTE_GROUP_DOC YES)
# set(DOXYGEN_EXTRACT_ALL YES)
# set(DOXYGEN_EXTRACT_PRIVATE NO)
# set(DOXYGEN_FILE_PATTERNS *.hpp)
# set(DOXYGEN_GENERATE_TREEVIEW YES)
# set(DOXYGEN_HIDE_IN_BODY_DOCS YES)
# set(DOXYGEN_QUIET YES)
# set(DOXYGEN_RECURSIVE YES)
# set(DOXYGEN_SORT_BY_SCOPE_NAME YES)
# set(DOXYGEN_SORT_MEMBER_DOCS NO)
# set(DOXYGEN_SOURCE_BROWSER NO)
# set(DOXYGEN_STRIP_CODE_COMMENTS NO)
# set(DOXYGEN_USE_MATHJAX YES)
# set(DOXYGEN_EXTRA_PACKAGES stmaryrd)
# set(DOXYGEN_EXCLUDE_SYMBOLS = impl)
# set(DOXYGEN_ENABLE_PREPROCESSING YES)
# set(DOXYGEN_PREDEFINED __NVCC__)
# set(DOXYGEN_REFERENCED_BY_RELATION NO)
# set(DOXYGEN_REFERENCES_RELATION NO)

# doxygen_add_docs(doc_abstract_interpreter_parsing
#                  "include/"
#                  ALL
#                  COMMENT "Generate HTML documentation")
